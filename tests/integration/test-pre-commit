#!/bin/bash
# Ultra simple test pre-commit hook for integration tests
set -e

# Simple checks that don't rely on library functions
echo "=== Testing Pre-commit Hook ==="
ERROR_COUNT=0

# Check for issues in any Lua file
if grep -r "unused_var\|local result" --include="*.lua" . 2>/dev/null | grep -v "_unused_var"; then
  echo "ERROR: Unused variable found in Lua files"
  ERROR_COUNT=$((ERROR_COUNT+1))
fi

# Check for trailing whitespace in Lua files
if grep -r "\s$" --include="*.lua" . 2>/dev/null; then
  echo "ERROR: Trailing whitespace found in Lua files"
  ERROR_COUNT=$((ERROR_COUNT+1))
fi

# Check for issues in any shell script, excluding .hooks-util directory
if grep -r "\`" --include="*.sh" --exclude-dir=".hooks-util" . 2>/dev/null; then
  echo "ERROR: Deprecated backtick found in shell scripts"
  ERROR_COUNT=$((ERROR_COUNT+1))
fi

# Exit with proper code
if [ $ERROR_COUNT -gt 0 ]; then
  echo "Found $ERROR_COUNT issues"
  exit 1
else
  echo "All checks passed!"
  exit 0
fi